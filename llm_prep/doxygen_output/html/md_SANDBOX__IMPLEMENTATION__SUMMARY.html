<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AXE: Bubblewrap Sandbox Implementation - Summary</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">AXE
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md_SANDBOX__IMPLEMENTATION__SUMMARY.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Bubblewrap Sandbox Implementation - Summary </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md1058"></a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1059"></a>
Overview</h1>
<p>Successfully implemented a bubblewrap-based sandbox security model for AXE that replaces the traditional whitelist-based approach with a default-allow model inside an isolated environment.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1060"></a>
Implementation Details</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1061"></a>
Files Created</h2>
<ol type="1">
<li><b><span class="tt"><a class="el" href="sandbox_8py.html">core/sandbox.py</a></span></b> (236 lines)<ul>
<li><span class="tt">SandboxManager</span> class for managing sandbox lifecycle</li>
<li>Bubblewrap command building from configuration</li>
<li>Tool blacklist validation</li>
<li>Environment detection and graceful error handling</li>
</ul>
</li>
<li><b><span class="tt"><a class="el" href="test__sandbox_8py.html">tests/test_sandbox.py</a></span></b> (584 lines)<ul>
<li>13 comprehensive tests covering all functionality</li>
<li>Unit tests, integration tests, edge cases, security tests</li>
<li>Environment-aware testing (CI compatibility)</li>
</ul>
</li>
<li><b><span class="tt"><a class="el" href="SANDBOX_8md.html">SANDBOX.md</a></span></b> (405 lines)<ul>
<li>Complete documentation of sandbox feature</li>
<li>Configuration guide with examples</li>
<li>Architecture diagram</li>
<li>Migration guide from whitelist to sandbox</li>
<li>Troubleshooting section</li>
</ul>
</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1062"></a>
Files Modified</h2>
<ol type="1">
<li><b><span class="tt"><a class="el" href="constants_8py.html">core/constants.py</a></span></b><ul>
<li>Added <span class="tt">sandbox</span> configuration section to <span class="tt">DEFAULT_CONFIG</span></li>
<li>Includes all namespace options, host binds, blacklist settings</li>
<li>Default: <span class="tt">enabled: false</span> for backward compatibility</li>
</ul>
</li>
<li><b><span class="tt"><a class="el" href="tool__runner_8py.html">core/tool_runner.py</a></span></b><ul>
<li>Integrated <span class="tt">SandboxManager</span> initialization in <span class="tt">__init__</span></li>
<li>Modified <span class="tt">is_tool_allowed()</span> to use blacklist in sandbox mode</li>
<li>Modified <span class="tt">run()</span> to delegate to sandbox when enabled</li>
<li>Maintains full backward compatibility with whitelist mode</li>
</ul>
</li>
<li><b><span class="tt"><a class="el" href="core_2____init_____8py.html">core/__init__.py</a></span></b><ul>
<li>Exported <span class="tt">SandboxManager</span> class</li>
</ul>
</li>
<li><b><span class="tt">axe.yaml</span></b><ul>
<li>Added comprehensive commented sandbox configuration section</li>
<li>Documents all options with inline comments</li>
<li>70 lines of configuration and documentation</li>
</ul>
</li>
</ol>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1063"></a>
Key Features</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1064"></a>
1. Default-Allow Security Model</h2>
<ul>
<li><b>Sandbox mode</b>: All tools allowed by default, optional blacklist for dangerous commands</li>
<li><b>Whitelist mode</b>: Traditional deny-by-default (backward compatible)</li>
<li>Automatic fallback if sandbox unavailable</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1065"></a>
2. Namespace Isolation</h2>
<ul>
<li>User namespace (root inside, unprivileged outside)</li>
<li>PID namespace (process isolation)</li>
<li>IPC namespace (inter-process communication isolation)</li>
<li>UTS namespace (hostname isolation)</li>
<li>CGroup namespace (control group isolation)</li>
<li>Optional network namespace (network isolation)</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1066"></a>
3. Filesystem Access Control</h2>
<ul>
<li>Workspace: Read-write access (project directory)</li>
<li>System paths: Read-only (<span class="tt">/usr</span>, <span class="tt">/lib</span>, <span class="tt">/bin</span>, <span class="tt">/etc</span>)</li>
<li>Hidden paths: Completely inaccessible (<span class="tt">~/.ssh</span>, <span class="tt">/root</span>)</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1067"></a>
4. Environment Detection</h2>
<ul>
<li>Detects bubblewrap availability</li>
<li>Graceful fallback to whitelist mode</li>
<li>Clear error messages for restricted environments</li>
<li>Works in CI/CD pipelines (with limitations)</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1068"></a>
Test Results</h1>
<div class="fragment"><div class="line">✅ All 13 tests pass successfully</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md1069"></a>
Test Coverage</h2>
<ol type="1">
<li><b>Unit Tests</b> (8 tests)<ul>
<li>Configuration parsing ✓</li>
<li>SandboxManager initialization ✓</li>
<li>Bubblewrap availability detection ✓</li>
<li>Command generation ✓</li>
<li>Tool blacklist validation ✓</li>
<li>Fallback to whitelist mode ✓</li>
<li>Host bind configuration ✓</li>
<li>Namespace options ✓</li>
</ul>
</li>
<li><b>Integration Tests</b> (3 tests)<ul>
<li>Backward compatibility ✓</li>
<li>Sandbox mode validation ✓</li>
<li>Command execution (environment-aware) ✓</li>
</ul>
</li>
<li><b>Edge Case Tests</b> (2 tests)<ul>
<li>Heredoc execution ✓</li>
<li>Pipe execution ✓</li>
</ul>
</li>
</ol>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1070"></a>
Configuration Example</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1071"></a>
Enabling Sandbox Mode</h2>
<div class="fragment"><div class="line">sandbox:</div>
<div class="line">  enabled: true</div>
<div class="line">  runtime: bubblewrap</div>
<div class="line">  </div>
<div class="line">  workspaces:</div>
<div class="line">    - path: .</div>
<div class="line">      writable: true</div>
<div class="line">  </div>
<div class="line">  host_binds:</div>
<div class="line">    readonly:</div>
<div class="line">      - /usr</div>
<div class="line">      - /lib</div>
<div class="line">      - /lib64</div>
<div class="line">      - /bin</div>
<div class="line">      - /etc</div>
<div class="line">      - /run</div>
<div class="line">      - /sys</div>
<div class="line">    writable: []</div>
<div class="line">    none:</div>
<div class="line">      - ~/.ssh</div>
<div class="line">      - ~/.gnupg</div>
<div class="line">      - /root</div>
<div class="line">  </div>
<div class="line">  tool_blacklist: []  # Optional: [&#39;rm&#39;, &#39;dd&#39;, &#39;mkfs&#39;]</div>
<div class="line">  </div>
<div class="line">  namespaces:</div>
<div class="line">    user: true</div>
<div class="line">    pid: true</div>
<div class="line">    uts: true</div>
<div class="line">    network: false</div>
<div class="line">    ipc: true</div>
<div class="line">    cgroup: true</div>
<div class="line">  </div>
<div class="line">  options:</div>
<div class="line">    new_session: true</div>
<div class="line">    die_with_parent: true</div>
<div class="line">    proc: /proc</div>
<div class="line">    dev: /dev</div>
<div class="line">    tmpfs: /tmp</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md1072"></a>
Security Benefits</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1073"></a>
Compared to Whitelist Mode</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Aspect  </th><th class="markdownTableHeadNone">Whitelist Mode  </th><th class="markdownTableHeadNone">Sandbox Mode  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Default behavior  </td><td class="markdownTableBodyNone">Deny all  </td><td class="markdownTableBodyNone">Allow all (inside sandbox)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Agent autonomy  </td><td class="markdownTableBodyNone">Low (frequent approvals)  </td><td class="markdownTableBodyNone">High (no approvals needed)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Host protection  </td><td class="markdownTableBodyNone">Config-based  </td><td class="markdownTableBodyNone">Kernel-enforced isolation  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Process isolation  </td><td class="markdownTableBodyNone">None  </td><td class="markdownTableBodyNone">Full (PID namespace)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Filesystem isolation  </td><td class="markdownTableBodyNone">Path checks  </td><td class="markdownTableBodyNone">Namespace isolation  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">User credentials  </td><td class="markdownTableBodyNone">Config-based  </td><td class="markdownTableBodyNone">Hidden completely  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Flexibility  </td><td class="markdownTableBodyNone">Must list every tool  </td><td class="markdownTableBodyNone">Blacklist only dangerous tools  </td></tr>
</table>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1074"></a>
Attack Surface Reduction</h2>
<ol type="1">
<li><b>Host filesystem</b>: Protected by mount namespace, only explicit binds visible</li>
<li><b>System processes</b>: Invisible to sandbox (PID namespace)</li>
<li><b>Network</b>: Optional isolation via network namespace</li>
<li><b>Credentials</b>: <span class="tt">~/.ssh</span>, <span class="tt">~/.gnupg</span> completely inaccessible</li>
<li><b>TTY attacks</b>: Prevented via <span class="tt">--new-session</span></li>
<li><b>Privilege escalation</b>: Limited by user namespace mapping</li>
</ol>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1075"></a>
Backward Compatibility</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1076"></a>
Preserved Functionality</h2>
<p>✅ Existing <span class="tt">axe.yaml</span> configurations work unchanged <br  />
 ✅ Whitelist mode available when <span class="tt">sandbox.enabled: false</span> <br  />
 ✅ All existing tool categories respected <br  />
 ✅ Forbidden paths still checked in whitelist mode <br  />
 ✅ Auto-approval and dry-run modes still work <br  />
</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1077"></a>
Migration Path</h2>
<ol type="1">
<li><b>Phase 1</b>: Install bubblewrap: <span class="tt">sudo apt install bubblewrap</span></li>
<li><b>Phase 2</b>: Test with <span class="tt">sandbox.enabled: true</span> in <span class="tt">axe.yaml</span></li>
<li><b>Phase 3</b>: Add tool blacklist if needed</li>
<li><b>Phase 4</b>: Adjust host binds for specific needs</li>
</ol>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1078"></a>
Known Limitations</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1079"></a>
Environment Restrictions</h2>
<ol type="1">
<li><b>Linux-only</b>: Requires Linux kernel with namespace support</li>
<li><b>CI limitations</b>: May not work in all CI environments due to security policies</li>
<li><b>Container restrictions</b>: Limited in some containerized environments</li>
<li><b>Root environments</b>: GitHub Actions runners may have permission issues</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1080"></a>
Bubblewrap Limitations</h2>
<ol type="1">
<li><b>No block devices</b>: Cannot mount ext4/ntfs images</li>
<li><b>FUSE supported</b>: FUSE filesystems work via <span class="tt">/dev/fuse</span></li>
<li><b>Kernel requirement</b>: Requires relatively recent kernel (3.8+)</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1081"></a>
Graceful Handling</h2>
<p>The implementation detects these limitations and:</p><ul>
<li>Returns clear error messages</li>
<li>Falls back to whitelist mode if needed</li>
<li>Continues to provide validation functionality</li>
<li>Documents the specific limitation encountered</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1082"></a>
Usage Scenarios</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1083"></a>
Scenario 1: Development Workflow</h2>
<div class="fragment"><div class="line">sandbox:</div>
<div class="line">  enabled: true</div>
<div class="line">  tool_blacklist: []  # Allow everything</div>
</div><!-- fragment --><p> <b>Use case</b>: Local development, trusted code</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1084"></a>
Scenario 2: Code Analysis</h2>
<div class="fragment"><div class="line">sandbox:</div>
<div class="line">  enabled: true</div>
<div class="line">  tool_blacklist: [&#39;rm&#39;, &#39;dd&#39;, &#39;mkfs&#39;, &#39;wget&#39;, &#39;curl&#39;]</div>
</div><!-- fragment --><p> <b>Use case</b>: Analyzing untrusted code, no destructive operations</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1085"></a>
Scenario 3: Network Isolated</h2>
<div class="fragment"><div class="line">sandbox:</div>
<div class="line">  enabled: true</div>
<div class="line">  namespaces:</div>
<div class="line">    network: true  # Enable network isolation</div>
</div><!-- fragment --><p> <b>Use case</b>: Running potentially malicious code, no network access</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1086"></a>
Scenario 4: Legacy Mode</h2>
<div class="fragment"><div class="line">sandbox:</div>
<div class="line">  enabled: false</div>
<div class="line">tools:</div>
<div class="line">  # Traditional whitelist configuration</div>
</div><!-- fragment --><p> <b>Use case</b>: Environments without bubblewrap, maximum compatibility</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1087"></a>
Performance Impact</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1088"></a>
Overhead</h2>
<ul>
<li><b>Command startup</b>: ~10-50ms per command (sandbox creation)</li>
<li><b>Runtime</b>: Negligible (namespace overhead is minimal)</li>
<li><b>Memory</b>: Small (~1-2MB per sandbox process)</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1089"></a>
Optimization</h2>
<ul>
<li>Namespaces are lightweight kernel features</li>
<li>No emulation or virtualization overhead</li>
<li>Direct syscall access (no translation layer)</li>
<li>Efficient bind mounts (no file copying)</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1090"></a>
Future Enhancements</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1091"></a>
Potential Improvements</h2>
<ol type="1">
<li><b>Resource limits</b>: Add CPU/memory constraints via cgroups</li>
<li><b>Multiple sandboxes</b>: Support concurrent workspace sandboxes</li>
<li><b>Sandbox profiles</b>: Pre-configured security levels</li>
<li><b>Audit logging</b>: Log all sandbox operations</li>
<li><b>Docker backend</b>: Alternative to bubblewrap</li>
<li><b>Windows support</b>: WSL2 or separate implementation</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1092"></a>
Extensibility</h2>
<p>The modular design allows:</p><ul>
<li>Adding new runtime backends (Docker, Podman)</li>
<li>Custom namespace configurations per workspace</li>
<li>Per-tool execution policies</li>
<li>Integration with system security frameworks (AppArmor, SELinux)</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1093"></a>
Documentation</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1094"></a>
Available Docs</h2>
<ol type="1">
<li><b><a class="el" href="SANDBOX_8md.html">SANDBOX.md</a></b>: Comprehensive user guide (405 lines)</li>
<li><b>Code comments</b>: Inline documentation in all modules</li>
<li><b>Test suite</b>: Examples of all features in use</li>
<li><b>axe.yaml</b>: Commented configuration template</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1095"></a>
Quick Start</h2>
<div class="fragment"><div class="line"># 1. Install bubblewrap</div>
<div class="line">sudo apt install bubblewrap</div>
<div class="line"> </div>
<div class="line"># 2. Enable in axe.yaml</div>
<div class="line">echo &quot;sandbox:&quot; &gt;&gt; axe.yaml</div>
<div class="line">echo &quot;  enabled: true&quot; &gt;&gt; axe.yaml</div>
<div class="line"> </div>
<div class="line"># 3. Run AXE</div>
<div class="line">python3 axe.py</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md1096"></a>
Conclusion</h1>
<p>The bubblewrap sandbox implementation successfully:</p>
<p>✅ Provides robust security through kernel namespace isolation <br  />
 ✅ Enables default-allow model for better agent autonomy <br  />
 ✅ Maintains complete backward compatibility <br  />
 ✅ Gracefully handles environment limitations <br  />
 ✅ Includes comprehensive tests and documentation <br  />
 ✅ Offers flexible configuration for various use cases <br  />
</p>
<p>The implementation is production-ready with proper fallbacks for environments where full sandboxing isn't available. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
