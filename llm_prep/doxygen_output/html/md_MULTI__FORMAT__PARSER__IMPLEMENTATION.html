<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AXE: Multi-Format Tool Call Parser Implementation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">AXE
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md_MULTI__FORMAT__PARSER__IMPLEMENTATION.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Multi-Format Tool Call Parser Implementation </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md665"></a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md666"></a>
Summary</h1>
<p>Successfully extended <span class="tt"><a class="el" href="xml__tool__parser_8py.html">xml_tool_parser.py</a></span> to support ALL common LLM tool-calling formats, solving the critical issue where agents get stuck when using non-standard syntax.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md667"></a>
Problem Solved</h1>
<p><b>Before</b>: Agents could only use <span class="tt">&lt;function_calls&gt;&lt;invoke&gt;</span> XML format. When Claude or other LLMs used natural formats like <span class="tt">&lt;bash&gt;command&lt;/bash&gt;</span> or <span class="tt"> ``</span>bash\ncommand<br  />
``<span class="tt"> </span>, these were NOT parsed, leaving agents stuck for hours.</p>
<p><b>After</b>: The parser now recognizes and executes 10+ different tool-calling formats, allowing agents to use whatever syntax feels natural.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md668"></a>
Supported Formats</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Format  </th><th class="markdownTableHeadNone">Example  </th><th class="markdownTableHeadNone">Status  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">XML function_calls  </td><td class="markdownTableBodyNone"><span class="tt">&lt;invoke name="read_file"&gt;...&lt;/invoke&gt;</span>  </td><td class="markdownTableBodyNone">✅ Existing (PR #6)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Bash XML tags  </td><td class="markdownTableBodyNone"><span class="tt">&lt;bash&gt;cat /tmp/file.txt&lt;/bash&gt;</span>  </td><td class="markdownTableBodyNone">✅ NEW  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Shell code blocks  </td><td class="markdownTableBodyNone"><span class="tt"> ``</span>bash\nls -la<br  />
<span class="tt"> ` \ilinebr &lt;/td&gt;    &lt;td class="markdownTableBodyNone"&gt; ✅ NEW \ilinebr &lt;/td&gt;  &lt;/tr&gt;
&lt;tr class="markdownTableRowEven"&gt;    &lt;td class="markdownTableBodyNone"&gt; Shell variants \ilinebr &lt;/td&gt;    &lt;td class="markdownTableBodyNone"&gt; ` </span>shell\nfind .<br  />
<span class="tt"> `, ` </span>sh\necho<br  />
<span class="tt"> ` \ilinebr &lt;/td&gt;    &lt;td class="markdownTableBodyNone"&gt; ✅ NEW \ilinebr &lt;/td&gt;  &lt;/tr&gt;
&lt;tr class="markdownTableRowOdd"&gt;    &lt;td class="markdownTableBodyNone"&gt; Inline code blocks \ilinebr &lt;/td&gt;    &lt;td class="markdownTableBodyNone"&gt; ` </span>bash ls -la<span class="tt"> ` \ilinebr &lt;/td&gt;    &lt;td class="markdownTableBodyNone"&gt; ✅ NEW \ilinebr &lt;/td&gt;  &lt;/tr&gt;
&lt;tr class="markdownTableRowEven"&gt;    &lt;td class="markdownTableBodyNone"&gt; AXE READ \ilinebr &lt;/td&gt;    &lt;td class="markdownTableBodyNone"&gt; ` </span>READ /path<span class="tt"> ` \ilinebr &lt;/td&gt;    &lt;td class="markdownTableBodyNone"&gt; ✅ NEW \ilinebr &lt;/td&gt;  &lt;/tr&gt;
&lt;tr class="markdownTableRowOdd"&gt;    &lt;td class="markdownTableBodyNone"&gt; AXE WRITE \ilinebr &lt;/td&gt;    &lt;td class="markdownTableBodyNone"&gt; ` </span>WRITE /path\ncontent<span class="tt"> ` \ilinebr &lt;/td&gt;    &lt;td class="markdownTableBodyNone"&gt; ✅ NEW \ilinebr &lt;/td&gt;  &lt;/tr&gt;
&lt;tr class="markdownTableRowEven"&gt;    &lt;td class="markdownTableBodyNone"&gt; AXE EXEC \ilinebr &lt;/td&gt;    &lt;td class="markdownTableBodyNone"&gt; ` </span>EXEC command``<span class="tt"> </span>  </td><td class="markdownTableBodyNone">✅ NEW  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Simple read_file  </td><td class="markdownTableBodyNone"><span class="tt">&lt;read_file&gt;/path&lt;/read_file&gt;</span>  </td><td class="markdownTableBodyNone">✅ NEW  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Simple shell  </td><td class="markdownTableBodyNone"><span class="tt">&lt;shell&gt;ls -la&lt;/shell&gt;</span>  </td><td class="markdownTableBodyNone">✅ NEW  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Simple write_file  </td><td class="markdownTableBodyNone"><span class="tt">&lt;write_file path="/tmp/x"&gt;content&lt;/write_file&gt;</span>  </td><td class="markdownTableBodyNone">✅ NEW  </td></tr>
</table>
<h1 class="doxsection"><a class="anchor" id="autotoc_md669"></a>
Implementation</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md670"></a>
New Functions Added</h2>
<ol type="1">
<li><b><span class="tt">parse_bash_tags()</span></b> - Parses <span class="tt">&lt;bash&gt;...&lt;/bash&gt;</span> format</li>
<li><b><span class="tt">parse_shell_codeblocks()</span></b> - Parses <span class="tt"> ``</span>bash/shell/sh <span class="tt"> ` blocks</span></li>
<li><span class="tt">**`parse_axe_native_blocks()`** - Parses ` </span>READ/WRITE/EXEC ``<span class="tt"> </span> blocks</li>
<li><b><span class="tt">parse_simple_xml_tags()</span></b> - Parses simple XML tags</li>
<li><b><span class="tt">deduplicate_calls()</span></b> - Removes duplicate tool calls (optimized with frozenset)</li>
<li><b><span class="tt">parse_all_tool_formats()</span></b> - Unified parser calling all format parsers</li>
<li><b><span class="tt">clean_tool_syntax()</span></b> - Removes tool syntax for cleaner display</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="autotoc_md671"></a>
Updated Functions</h2>
<ul>
<li><b><span class="tt">process_agent_response()</span></b> - Now uses <span class="tt">parse_all_tool_formats()</span> to handle all formats</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md672"></a>
Key Features</h2>
<ul>
<li><b>Deduplication</b>: Identical commands are deduplicated to avoid redundant execution</li>
<li><b>Comment filtering</b>: Lines starting with <span class="tt">#</span> in shell blocks are ignored</li>
<li><b>Empty command filtering</b>: Whitespace-only commands are ignored</li>
<li><b>Multi-line support</b>: Multi-line shell blocks execute each line separately</li>
<li><b>Optional content</b>: WRITE blocks can have empty content for creating empty files</li>
<li><b>Inline support</b>: Code blocks without newlines after language specifier are supported</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md673"></a>
Code Quality</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md674"></a>
Code Review Issues Addressed</h2>
<p>✅ Made newline optional in shell codeblocks for inline format <br  />
 ✅ Improved regex patterns to use non-greedy matching <br  />
 ✅ Escaped backticks in regex for clarity <br  />
 ✅ Optimized deduplication using frozenset (better performance than JSON) <br  />
 ✅ Made content optional in WRITE blocks <br  />
 ✅ Fixed clean_tool_syntax to match parser logic <br  />
</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md675"></a>
Security Scan</h2>
<p>✅ <b>0 security alerts</b> from CodeQL</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md676"></a>
Testing</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md677"></a>
Test Coverage</h2>
<p><b>30+ tests</b> covering all formats and edge cases:</p>
<ul>
<li>✅ All parser functions tested individually</li>
<li>✅ Inline code blocks without newlines</li>
<li>✅ Commands with backticks (command substitution)</li>
<li>✅ Paths with spaces</li>
<li>✅ Multi-line commands</li>
<li>✅ Empty WRITE blocks</li>
<li>✅ Deduplication</li>
<li>✅ Comment filtering</li>
<li>✅ Empty command filtering</li>
<li>✅ Tool syntax cleaning</li>
<li>✅ Integration tests with actual file operations</li>
<li>✅ Mixed format responses</li>
<li>✅ All existing PR #6 tests still pass</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md678"></a>
Test Results</h2>
<div class="fragment"><div class="line">XML TOOL PARSER TEST SUITE: ✅ ALL 30+ TESTS PASSED</div>
<div class="line">INTEGRATION TESTS: ✅ ALL 7 SCENARIOS PASSED</div>
<div class="line">EDGE CASE TESTS: ✅ ALL TESTS PASSED</div>
<div class="line">EXISTING TESTS (write_blocks): ✅ ALL TESTS PASSED</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md679"></a>
Files Changed</h1>
<ol type="1">
<li><b><span class="tt"><a class="el" href="xml__tool__parser_8py.html">utils/xml_tool_parser.py</a></span></b> - Core parser implementation (+230 lines)</li>
<li><b><span class="tt"><a class="el" href="test__xml__tool__parser_8py.html">test_xml_tool_parser.py</a></span></b> - Comprehensive test suite (+240 lines)</li>
</ol>
<h1 class="doxsection"><a class="anchor" id="autotoc_md680"></a>
Backward Compatibility</h1>
<p>✅ <b>100% backward compatible</b> - All existing XML function call parsing from PR #6 continues to work exactly as before.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md681"></a>
Impact</h1>
<p>This change will prevent agents from getting stuck when they naturally use different tool-calling formats. Instead of spending 4+ hours blocked (as happened in the reported incident), agents can now use any common format and immediately get results.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md682"></a>
Examples</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md683"></a>
Example 1: Claude's Natural Format</h2>
<div class="fragment"><div class="line">Agent: &lt;bash&gt;cat /tmp/playground/MISSION.md&lt;/bash&gt;</div>
<div class="line">Result: ✅ File contents returned</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md684"></a>
Example 2: Code Block Format</h2>
<div class="fragment"><div class="line">Agent: </div>
</div><!-- fragment --><p> bash ls -la /tmp </p><div class="fragment"><div class="line">Result: ✅ Directory listing returned</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md685"></a>
Example 3: AXE Native Format</h2>
<div class="fragment"><div class="line">Agent: </div>
</div><!-- fragment --><p> READ /tmp/file.txt``` Result: ✅ File contents returned </p><div class="fragment"><div class="line">### Example 4: Mixed Formats in Single Response</div>
</div><!-- fragment --><p> Agent: Let me complete this task:</p>
<p>First, read the input: </p><div class="fragment"><div class="line">input.txt</div>
</div><!-- fragment --><p>Then list files: &lt;bash&gt;ls -la&lt;/bash&gt;</p>
<p>Finally, create output: </p><div class="fragment"><div class="line"> result.txt</div>
<div class="line">Processing complete!</div>
</div><!-- fragment --><p>Result: ✅ All 3 commands executed, results returned </p><div class="fragment"><div class="line">## Success Criteria</div>
<div class="line"> </div>
<div class="line">All requirements from the problem statement have been met:</div>
<div class="line"> </div>
<div class="line">- ✅ `&lt;bash&gt;command&lt;/bash&gt;` tags parsed and executed</div>
<div class="line">- ✅ ` ```bash\n...\n</div>
</div><!-- fragment --><p> <span class="tt"> code blocks parsed and executed</p><ul>
<li>✅ </li>
</ul>
<p></span> <span class="tt">shell\n...\n</span> <span class="tt"> code blocks parsed and executed</p><ul>
<li>✅ </li>
</ul>
<p></span> <span class="tt">sh\n...\n</span> <span class="tt"> code blocks parsed and executed</p><ul>
<li>✅ </li>
</ul>
<p></span> <span class="tt">READ /path</span> <span class="tt"> blocks parsed and executed</p><ul>
<li>✅ </li>
</ul>
<p></span> <span class="tt">WRITE /path\ncontent</span> <span class="tt"> blocks parsed and executed</p><ul>
<li>✅ </li>
</ul>
<p></span> <span class="tt">EXEC command</span> <span class="tt"> blocks parsed and executed</p><ul>
<li>✅ Simple XML tags (</li>
</ul>
<p></span>&lt;read_file&gt;<span class="tt">, </span>&lt;shell&gt;`) parsed</p><ul>
<li>✅ Duplicate commands deduplicated</li>
<li>✅ Empty/whitespace-only commands ignored</li>
<li>✅ Comments in code blocks ignored</li>
<li>✅ Multi-line code blocks execute each line</li>
<li>✅ All existing PR #6 functionality still works</li>
<li>✅ Comprehensive test coverage for all formats</li>
<li>✅ Results appear in conversation history for agents to see </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
