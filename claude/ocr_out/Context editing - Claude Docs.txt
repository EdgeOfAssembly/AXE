--- Page 1 ---
13.1.2026 klo 1.32
Context editing
Claude Docs
Claude Docs
Capabilities
Context editing
Context editing
Automatically manage conversation context as it grows with context editing:
Copy page
Overview
Context editing allows yoU to automatically manage conversation context as it grows,
helping YoU optimize costs and stay within context window limits, YoU can use server-side
API strategies, client-side SDK features, or both together:
Where
Approach
Strategies
How it works
itruns
Tool result clearing
Applied before the prompt reaches
Server-
clear_tool_uses_20250919
)
Claude. Clears
specific content from
API
side
Thinking block clearing
conversation history: Each strategy
clear_thinking_20251015
)
can be configured independently:
Available in Python and TypeScript
SDKs when
tool
runner
Client-
SDK
Compaction
Generates a summary and replaces
side
full conversation history: See
Compaction below:
Server-side strategies
Context editing is currently in beta with support for tool result clearing and thinking block
clearing: To enable it; use the beta header
context-management-2025-06-27
in your API
requests:
Please reach out through our feedback form to share your feedback on this feature:
Tool result
clearing
https:Ilplatform claude com/docslen/build-with-claudelcontext-editing
1/20
using

--- Page 2 ---
13.1.2026 klo 1.32
Context editing
Claude Docs
Claude Docs
the oldest tool results In chronological order; replacing tnem wIth placenolder text to let
Claude know the tool result was removed: By default; only tool results are cleared: You
can optionally clear both tool results and tool calls (the tool use parameters) by setting
clear_tool_inputs
to true:
Thinking block clearing
The
clear_thinking_20251015
strategy manages
thinking
blocks in conversations
when extended thinking is enabled: This strategy automatically clears older thinking
blocks from previous turns:
Default behavior: When extended thinking is enabled without configuring the
clear_thinking_20251015
strategy, the API automatically keeps only the thinking
blocks from the last assistant turn (equivalent to
keep: {type:
thinking_turns'
value:
1} ).
To maximize cache hits, preserve all thinking blocks by setting  keep:
"all"
Anassistant conversation turn may include multiple content blocks
when using tools)
and multiple thinking blocks (e g: with interleaved thinking) .
Context editing happens server-side
Context editing is applied server-side before the prompt reaches Claude: Your client
application maintains the full, unmodified conversation history-~you do not need to sync
your client state with the edited version; Continue managing your full conversation history
locally as you normally would:
Context editing and prompt caching
Context editing's interaction with prompt caching varies by strategy:
Tool result clearing: Invalidates cached prompt prefixes when content is cleared: To
account for this we recommend clearing enough tokens to make the cache invalidation
worthwhile Use the
clear_at_least
parameter to ensure a minimum number of
tokens is cleared each time You'Il incur cache write costs each time content is cleared,
but subsequent requests can reuse the newly cached prefix
Thinking block clearing: When thinking blocks are kept in context (not cleared), the
prompt cache is preserved, enabling cache hits and reducing input token costs. When
https:Ilplatform.claude comldocslenlbuild-with-claudelcontext-editing
2/20
(e.g: `

--- Page 3 ---
13.1.2026 klo 1.32
Context editing
Claude Docs
Claude Docs
pelUMalice Ul CUIEXL WIIIUUWV avallaumty-
Supported models
Context editing is available on:
Claude Opus 4.5
claude-opus-4-5-20251101
)
Claude Opus 4.1
cZaude-opus-4-1-20250805
)
Claude Opus 4 ( cZaude-opus-4-20250514
)
Claude Sonnet 4.5
claude-sonnet-4-5-20250929
Claude Sonnet 4
claude-sonnet-4-20250514
)
Claude Haiku 4.5
claude-haiku-4-5-20251001
)
Toolresult
clearing usage
The simplest way to enable toolresult clearing is to specify only the strategy type; as all
other configuration options will use their default values:
cURL
https:Ilplatform claude com/docslen/build-with-claudelcontext-editing
3/20

--- Page 4 ---
13.1.2026 klo 1.32
Context editing
Claude Docs
Claude Docs
--header
"anthropic-version:
2023-06-01"
-~header "content-type: application/json"
-~header "anthropic-beta:
context-management-2025-06-27"
-data
{
"model" :
"claude-sonnet-4-5"
I
max_tokens 
4096 ,
I
messages" :
[
"role" :
"user"
"content"
"Search
for
recent developments
in
AI"
]
"tools":
[
II
"type'
web_search_20250305"
"
II
name
web_search"
]
"context_management" :
{
"edits" :
{"type" :
"clear_tool_uses_20250919"}
1
}
Advanced configuration
You can customize the tool result clearing behavior with additional parameters:
cURL
https:Ilplatform claude com/docslen/build-with-claudelcontext-editing
4/20

--- Page 5 ---
13.1.2026 klo 1.32
Context editing
Claude Docs
Claude Docs
--header
"anthropic-version:
2023-06-01"
-~header "content-type: application/json"
-~header "anthropic-beta:
context-management-2025-06-27"
-data
{
"model" :
"claude-sonnet-4-5"
I
max_tokens 
4096 ,
I
messages" :
[
"role" :
"user"
"content"
"Create
a
simple
command
line
calculator
app Using
]
"tools":
[
"type'
"text_editor_20250728"
"
name
"str_replace_based_edit_tool"
H
max_characters
10000
}
{
I
T
"type'
web_search_20250305"
"
H
name
web_search"
max_Uses" :
3
]
"context_management" :
{
"edits" :
L
M
type" :
"clear_tool_uses_20250919"
I
trigger" :
{
"type" :
H
input_tokens
"value" :
30000
} _
"keep" :
{
"type" :
"tool_uses"
"value" :
3
}
"clear_at_Least" :
{
M
"type" -
input_tokens
"value" :
5000
} _
"excLude_tools" :
["web_search" ]
}
https:Ilplatform.claude comldocslenlbuild-with-claudelcontext-editing
5/20

--- Page 6 ---
13.1.2026 klo 1.32
Context editing
Claude Docs
Claude Docs
Enable thinking block clearing to manage context and prompt caching effectively when
extended thinking is enabled:
cURL
curl https: / /api.anthropic. com/v1/messages
-~header
"x-api-key:
SANTHROPIC_API_KEY"
~~header "anthropic-Version:
2023-06-01"
~~header "content-type: application/json
-~header
"anthropic-beta:
context-management-2025-06-27"
-data
{
"model" :
"claude-sonnet-4-5-20250929"
H
max_tokens"
1024 _
I
messages" :
[...]
I
thinking" :
{
"type'
"enabled"
I
budget_tokens" :
10000
} ,
"context_management" :
{
"edits" :
I
type" :
"clear_thinking_20251015"
"keep" :
{
"
"type" :
thinking_turns
"value" :
2
}
}
Configuration options for thinking block clearing
The
clear_thinking_20251015   strategy supports the following configuration:
Configuration
Default
Description
option
Defines how many recent assistant turns with
{type:
thinking blocks to preserve: Use
{type:
H
I
M
keep
thinking_turns"
thinking_turns
value:
N}
where Nmust
value:
1}
be > 0 to
keep the last N turns; or
"all"
to
all
thinking blocks:
https:Ilplatform claude com/docslen/build-with-claudelcontext-editing
6/20
keep

--- Page 7 ---
13.1.2026 klo 1.32
Context editing
Claude Docs
Claude Docs
I[
Keep thinking
bZocks
from
the
Last
3
assistant
turns
"type" :
"clear_thinking_20251015"
"keep" :
{
H
"type" :
thinking_turns'
"value" :
3
}
1 [
Keep al1 thinking
blocks
(maximizes
cache hits)
"type" :
"clear_thinking_20251015"
"keep" :
"all"
Combining strategies
You can use both
thinking block clearing and tool result clearing together:
When using multiple strategies, the
clear_thinking_20251015   strategy must be listed
first in the
edits
array:
Python
https:Ilplatform claude com/docslen/build-with-claudelcontext-editing
7/20

--- Page 8 ---
13.1.2026 klo 1.32
Context editing
Claude Docs
Claude Docs
max_tokens-1024 ,
messages=[... ] ,
thinking-{
"type" :
"enabled"
"budget_tokens" _
10000
} _
tools=[...1,
betas=[ "context-management-2025-06-27"] ,
context_management={
"edits" :
[
"type" :
"clear_thinking_20251015"
"keep'
{
I
type" :
thinking_turns'
I -
value" :
2
}
{
"type"
"clear_tool_uses_20250919"
"trigger" :
{
H
type" :
"input_tokens"
"value" :
50000
}
"keep": {
I
type" :
"tool_uses'
"value" :
5
Configuration options fortoolresult clearing
Configuration option
Default
Description
Defines when the context editing strategy activates. Once
100,000
the prompt exceeds this threshold; clearing will begin: You
trigger
input
can specify this value in either
input_tokens
or
tokens
tool_uses
Defines how many recent tool uselresult pairs to keep after
3 tool uses
clearing occurs The API removes the oldest tool interactions
first; preserving the most recent ones:
https:Ilplatform claude com/docslen/build-with-claudelcontext-editing
8/20
" :
keep

--- Page 9 ---
13.1.2026 klo 1.32
Context editing
Claude Docs
Claude Docs
strategy activates If the API can't clear at least the
specified
clear_at_Zeast
None
amount; the strategy will not be applied  This helps determine
if context clearing is worth breaking your prompt cache
List of tool names whose tool uses and results should never
exclude_tools
None
be cleared; Useful for preserving important context;
Controls whether the tool call parameters are cleared along
clear_tool_inputs
false
with the tool results. By default; only the tool results are
cleared while keeping Claudes original tool calls visible.
Context editing response
You can see which context edits were
applied to your request using the
context_management
response field, along with helpful statistics about the content and
input tokens cleared:
Response
"id" :
msg_013Zva2CMHLNnXjNJJKqJZEF"
M
"type":
message"
"role" :
"assistant"
"content" :
[<.Jc
"usage" :
{_
:},
"context_management":
{
"applied_edits" :
[
1 |
When
using
clear_thinking_20251015
"type"
"clear_thinking_20251015"
"cleared_thinking_turns" :
3 ,
"cleared_input_tokens 
15000
}
When using
clear_tool_uses_20250919
{
"type"
"clear_tool_uses_20250919"
"cleared_tool_uses" :
8 ,
"
'cleared_input_tokens"
50000
https:Ilplatform.claude comldocslenlbuild-with-claudelcontext-editing
9/20

--- Page 10 ---
13.1.2026 klo 1.32
Context editing
Claude Docs
Claude Docs
Streaming Response
"type" :
message_delta"
"delta":
{
"stop_reason" :
"end_turn"
"stop_sequence" :
null
} _
"usage" :
"output_tokens" :
1024
}
"context_management":
{
"applied_edits":
[
.
}
Token counting
The token counting endpoint supports context management; allowing YoU to preview how
many tokens your prompt willuse after context editing is applied;
cURL
https:Ilplatform claude com/docslen/build-with-claudelcontext-editing
10/20

--- Page 11 ---
13.1.2026 klo 1.32
Context editing
Claude Docs
Claude Docs
--header
"anthropic-version:
2023-06-01"
-~header "content-type: application/json"
-~header "anthropic-beta:
context-management-2025-06-27"
-data
{
"model" :
"claude-sonnet-4-5"
I
messages" :
[
"role"
"user"
"content"
"Continue
our
conversation. .
] ,
"tools" :
[.:1,
"context_management"
{
"edits" :
[
H
type" :
"clear_tool_uses_20250919"
I
'trigger" :
{
H
"type"
'input_tokens
"value" :
30000
} _
"keep": {
"type" -
"tool_uses'
"value" :
5
}
Response
"input_tokens
25000 ,
"context_management" :
{
"original_input_tokens" :
70000
X
The response shows both the final token count after context management is
applied
input_tokens
) and the original token count before any clearing occurred
original_input_tokens )_
https:Ilplatform claude com/docslen/build-with-claudelcontext-editing
11/20

--- Page 12 ---
13.1.2026 klo 1.32
Context editing
Claude Docs
Claude Docs
Context editing can be combined with the memory tool: When your conversation context
approaches the configured clearing threshold; Claude receives an automatic warning to
preserve important information. This enables Claude to save tool results or context to its
memory files before theyre cleared from the conversation history:
This combination allows you to:
Preserve important context: Claude can write essential information from tool results
to memory files before those results are cleared
Maintain long-running workflows: Enable agentic workflows that would otherwise
exceed context limits by offloading information to persistent storage
Access information on demand: Claude can look up previously cleared information
from memory files when needed; rather than keeping everything in the active
context window
For example; in a file editing workflow where Claude performs many operations, Claude
can summarize completed changes to memory files as the context grows. When tool
results are cleared, Claude retains access to that information through its memory system
and can continue working effectively:
To use both features together; enable them in your API request:
Python
response
=
client.beta.messages . create(
model-"claude-sonnet-4-5"
max_tokens-4096 ,
messages=[ .
'
tools=[
"type'
memory_20250818"

T
name
memory"
} [
#
Your
other
tools
] ,
betas=[ "context-management-2025-06-27"] ,
context_management={
"edits" :
L
{"type" :
"clear_tool_uses_20250919"}
https:Ilplatform.claude comldocslenlbuild-with-claudelcontext-editing
12/20

--- Page 13 ---
13.1.2026 klo 1.32
Context editing
Claude Docs
Claude Docs
Compaction is available in the Python and TypeScript SDKs when using the
tool_runner
method:
Compaction is an SDK feature that automatically manages conversation context by
generating summaries when token usage grows too large. Unlike server-side context
editing strategies that clear content; compaction instructs Claude to summarize the
conversation history then replaces the full history with that summary: This allows Claude
to continue working on long-running tasks that would otherwise exceed the context
window:
How compaction works
When compaction is enabled; the SDK monitors token usage after each model response:
1,
Threshold check: The SDK calculates total tokens as
input_tokens
cache_creation_input_tokens
+
cache_read_input
tokens
+
output_tokens
2.
Summary generation: When the threshold is exceeded,a summary prompt is injected
as a user turn; and Claude
generates a structured summary wrapped in
<summary>
<
summary>
tags
3.
Context replacement: The SDK extracts the summary and replaces the entire
message history with it
4.
Continuation: The conversation resumes from the summary, with Claude picking up
where it left off
Using compaction
Add
compaction_control
to your
tool_runner
call:
Python
https:Ilplatform claude com/docslen/build-with-claudelcontext-editing
13/20

--- Page 14 ---
13.1.2026 klo 1.32
Context editing
Claude Docs
Claude Docs
client
=
anthropic. Anthropic()
runner
=
client.beta.messages.tool_runner(
model="claude-sonnet-4-5"
max_tokens-4096 ,
tools=[...]c
messages=[
"role" :
"user"
"content"
"Analyze
all
the
files
in
this directory
and
write
a
SU
]
compaction_control-{
"enabled"
True _
"context_token_threshold"_
100000
for
message
in
runner:
print(f"Tokens
used:
{message.usage. input_tokens}")
final
=
runner.until_done()
What happens during compaction
As the conversation grows, the message history accumulates:
Before compaction (approaching 1OOk tokens):
H
"role" :
user"
"content"
Analyze
all
files
and
write
a
report.
f _
"role" :
"assistant"
"content":
"I'LL help _
Let
me
start
by
reading _
"role" :
I
user"
"content":
[{
"type" :
"tool_result"
"tool_use_id"
"role" :
"assistant"
"content":
"
Based
on
filel.txt ,
I
see _
} ,
H
"role"_
user"
"content":
[{
"type" :
"tool_result"
"tool_use_id":
"role" :
"assistant"
"content":
"After analyzing
file2.txt.
} _
50
more exchanges
Like
this
When tokens exceed the threshold, the SDK injects a summary request and Claude
generates a summary: The entire history is then replaced:
https:Ilplatform.claude comldocslenlbuild-with-claudelcontext-editing
14/20

--- Page 15 ---
13.1.2026 klo 1.32
Context editing
Claude Docs
Claude Docs
"role" :
"assistant"
"content" :
"#
Task Overview"
nThe
user
requested analysis
of directory
file
Claude continues working from this summary as if it were the original conversation
history:
Configuration options
Parameter
Type
Required
Default
Description
Whether to enable
enabled
boolean
Yes
automatic compaction
Token count at which
context_token_threshold
number
No
100,000
compaction triggers
Same as main
Model to use for generating
model
string
No
model
summaries
Custom prompt for
summary_prompt
string
No
See below
summary generation
Choosing a token threshold
The threshold determines when compaction occurs. A lower threshold means more
frequent compactions with smaller context windows. A higher threshold allows more
context but risks hitting limits.
Python
https:Ilplatform claude com/docslen/build-with-claudelcontext-editing
15/20

--- Page 16 ---
13.1.2026 klo 1.32
Context editing
Claude Docs
Claude Docs
"enabled"
True _
"context_token_threshold" :
50000
#
Less
frequent compaction
when
You
need
more
context
compaction_control-{
"enabLed"
True =
"context_token_threshold" :
150000
Using a different model for summaries
You can use a faster or cheaper model for generating summaries:
Python
compaction_control-{
"enabled" :
True ,
"context_token_threshold" :
100000 _
"model":
"claude-haiku-4-5"
Custom summary prompts
can provide a custom prompt for domain-specific needs. Your prompt should instruct
Claude to wrap its summary in
<summary></summary> tags 
Python
compaction_control={
"enabled" :
True _
"context_token_threshold"
100000 _
I
summary_prompt
M
Summarize
the
research
conducted
S0
including:
Sources
consulted
and key findings
Questions
answered
and remaining
unknowns
Recommended
next steps
M M M
your  summary
in
<summary></summary>
tags _
https:Ilplatform.claude comldocslenlbuild-with-claudelcontext-editing
16/20
You
far ,
Wrap

--- Page 17 ---
13.1.2026 klo 1.32
Context editing
Claude Docs
Claude Docs
The built-in summary prompt instructs Claude to create a structured continuation
summary including:
1.
Task Overview: The user's core request, success criteria, and constraints
2.
Current State: What has been completed; files modified, and artifacts produced
3
Important Discoveries: Technical constraints, decisions made; errors resolved, and
failed approaches
4.
Next
Steps: Specific actions needed, blockers, and priority order
5
Context to Preserve: User preferences, domain-specific details, and commitments
made
This structure enables Claude to resume work
efficiently without losing important
context or repeating mistakes;
View full default prompt
Limitations
Server-side tools
Compaction requires special consideration when using server-side tools such as web search
or web fetch:
When using server-side tools, the SDK may incorrectly calculate token usage, causing
compaction to trigger at the wrong time;
For example; after a web search operation, the API response might show:
"usage" :
{
"input_tokens" :
63000 ,
"cache_read_input_tokens" :
270000 _
"output_tokens" :
1400
}
https:Ilplatform.claude comldocslenlbuild-with-claudelcontext-editing
17/20

--- Page 18 ---
13.1.2026 klo 1.32
Context editing
Claude Docs
Claude Docs
calls made by the server-side tool, not your actual conversation context; Your real context
length might only be the 63,000
input_tokens
but the SDK sees 333k and triggers
compaction prematurely:
Workarounds:
Use the token counting endpoint to
accurate context length
Avoid compaction when using server-side tools extensively
Tool use edge cases
When compaction is triggered while a tool use response is pending; the SDK removes the
tool use block from the message history before generating the summary: Claude will re-
issue the tool call after resuming from the summary if still needed;
Monitoring compaction
Enable logging to track when compaction occurs:
Python
import Logging
Zogging.basicConfig(Level-Logging
INFO)
Logging.getLogger( "anthropic.Lib.tools") . setLevel(Zogging. INFO)
#
Logs Wilz
show:
#
INFO :
Token
usage
105000
has exceeded
the
threshold
of
100000 _
Performing
Co
#
INFO :
Compaction
complete
New
token
usage:
2500
When to use compaction
Good use cases:
Long-running agent tasks that process many files or data sources
Research workflows that accumulate large amounts of information
Multi-step tasks with clear; measurable progress
Tasks that produce artifacts (files, reports) that persist outside the conversation
Less ideal use cases:
https:Ilplatform claude com/docslen/build-with-claudelcontext-editing
18/20
get

--- Page 19 ---
13.1.2026 klo 1.32
Context editing
Claude Docs
Claude Docs
Tasks that need to maintain exact state across many variables
Claude Docs
Solutions
Learn
AI
agents
Code modernization
Catalog
Coding
Courses
Customer support
Use cases
Education
Connectors
Financial services
Customer stories
Government
Engineering at Anthropic
Life sciences
Events
Powered by Claude
Partners
Service partners
Amazon Bedrock
Startups program
Google Cloud's Vertex Al
Company
Anthropic
Careers
Economic Futures
Research
News
Responsible Scaling Policy
Security and compliance
Transparency
Help and security
Availability
Status
https:Ilplatform claude com/docslen/build-with-claudelcontext-editing
19/20
Blog

--- Page 20 ---
13.1.2026 klo 1.32
Context editing
Claude Docs
Claude Docs
Terms and policies
Privacy policy
Responsible disclosure policy
Terms of service: Commercial
Terms of service: Consumer
Usage policy
https:Ilplatform claude com/docslen/build-with-claudelcontext-editing
20/20